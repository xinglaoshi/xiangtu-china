// ç¬¬äºŒç« ï¼šå·®åºæ ¼å±€ - å…³ç³»ç½‘ç»œå»ºæ„æ¸¸æˆ

const Chapter2 = {
    currentStep: 0,
    relationshipCircles: {
        circle1: [], // æœ€å†…åœˆï¼šå®¶äºº
        circle2: [], // ç¬¬äºŒåœˆï¼šäº²æˆšæœ‹å‹
        circle3: [], // ç¬¬ä¸‰åœˆï¼šé‚»å±…åŒäº‹
        circle4: []  // æœ€å¤–åœˆï¼šé™Œç”Ÿäºº
    },
    scenarios: [],
    insights: [],
    
    // é¢„è®¾åœºæ™¯æ•°æ®
    steps: [
        // Step 0: å¼•å¯¼é¡µ
        {
            type: 'intro',
            title: 'ç†è§£å·®åºæ ¼å±€',
            content: `
                <div class="chapter2-intro">
                    <div class="intro-icon">ğŸ­</div>
                    <h2>ä»€ä¹ˆæ˜¯"å·®åºæ ¼å±€"ï¼Ÿ</h2>
                    <div class="intro-text">
                        <p>è´¹å­é€šç”¨ä¸€ä¸ªæ¯”å–»æ¥æè¿°ä¸­å›½ä¼ ç»Ÿç¤¾ä¼šçš„äººé™…å…³ç³»ï¼š</p>
                        <blockquote>
                            "å¥½åƒæŠŠä¸€å—çŸ³å¤´ä¸¢åœ¨æ°´é¢ä¸Šæ‰€å‘ç”Ÿçš„ä¸€åœˆåœˆæ¨å‡ºå»çš„æ³¢çº¹ï¼Œ
                            æ¯ä¸ªäººéƒ½æ˜¯ä»–ç¤¾ä¼šå½±å“æ‰€æ¨å‡ºå»çš„åœˆå­çš„ä¸­å¿ƒã€‚"
                        </blockquote>
                        <p><strong>æ ¸å¿ƒç‰¹ç‚¹ï¼š</strong></p>
                        <ul>
                            <li>âœ“ ä»¥"æˆ‘"ä¸ºä¸­å¿ƒï¼Œå‘å¤–ä¸€åœˆåœˆæ¨</li>
                            <li>âœ“ ä¸åŒåœˆå±‚çš„äººï¼Œæƒåˆ©ä¹‰åŠ¡ä¸åŒ</li>
                            <li>âœ“ æ²¡æœ‰å›ºå®šçš„"å›¢ä½“"è¾¹ç•Œ</li>
                        </ul>
                    </div>
                    <button class="next-btn" onclick="Chapter2.nextStep()">
                        å¼€å§‹ä½“éªŒ â†’
                    </button>
                </div>
            `
        },
        
        // Step 1: ç»˜åˆ¶å…³ç³»åœˆ
        {
            type: 'draw-circles',
            title: 'ç»˜åˆ¶ä½ çš„å…³ç³»åœˆ',
            instruction: 'ä»"æˆ‘"å¼€å§‹ï¼ŒæŠŠç”Ÿæ´»ä¸­çš„äººæ”¾è¿›ä¸åŒçš„åœˆå±‚',
            people: [
                { name: 'çˆ¶æ¯', defaultCircle: 1 },
                { name: 'å…„å¼Ÿå§å¦¹', defaultCircle: 1 },
                { name: 'å ‚å…„å¼Ÿ', defaultCircle: 2 },
                { name: 'è¡¨å…„å¼Ÿ', defaultCircle: 2 },
                { name: 'è€åŒå­¦', defaultCircle: 2 },
                { name: 'åŒäº‹', defaultCircle: 3 },
                { name: 'é‚»å±…', defaultCircle: 3 },
                { name: 'å¤–å–å°å“¥', defaultCircle: 4 },
                { name: 'å¿«é€’å‘˜', defaultCircle: 4 }
            ]
        },
        
        // Step 2-4: æƒ…å¢ƒé€‰æ‹©ï¼ˆå·®åºæ ¼å±€ vs å›¢ä½“æ ¼å±€ï¼‰
        {
            type: 'scenario',
            title: 'æƒ…å¢ƒä¸€ï¼šå€Ÿé’±',
            question: 'äº²æˆšæ‰¾ä½ å€Ÿ5000å…ƒï¼Œè¯´æ€¥ç”¨ï¼Œä½ ä¼šæ€ä¹ˆåšï¼Ÿ',
            options: {
                differential: {
                    label: 'å·®åºæ ¼å±€æ€ç»´',
                    choices: [
                        { text: 'çœ‹æ˜¯è°ï¼šç›´ç³»äº²å±å€Ÿï¼Œè¿œæˆ¿äº²æˆšæ¨è„±', key: 'A' },
                        { text: 'çœ‹å…³ç³»ï¼šå¹³æ—¶èµ°å¾—è¿‘å°±å€Ÿï¼Œä¸ç†Ÿå°±æ‰¾ç†ç”±', key: 'B' }
                    ],
                    result: 'ä½ çš„æ€ç»´ä½“ç°äº†**å·®åºæ ¼å±€**ï¼šåŒæ ·æ˜¯"äº²æˆš"ï¼Œä½†æ ¹æ®å…³ç³»è¿œè¿‘åšå‡ºä¸åŒå†³å®šã€‚è¿™åœ¨ä¹¡åœŸç¤¾ä¼šæ˜¯åˆç†çš„â€”â€”"è‡ªå·±äºº"å’Œ"å¤–äºº"æœ‰æ˜ç¡®åŒºåˆ†ã€‚[1]'
                },
                group: {
                    label: 'å›¢ä½“æ ¼å±€æ€ç»´',
                    choices: [
                        { text: 'çœ‹åˆ¶åº¦ï¼šå¦‚æœæœ‰å€Ÿæ¡ã€åˆ©æ¯ï¼ŒæŒ‰æµç¨‹æ¥', key: 'C' },
                        { text: 'çœ‹èƒ½åŠ›ï¼šåªè¦æˆ‘æœ‰ä½™é’±ï¼Œä¸ç®¡æ˜¯è°éƒ½æ„¿æ„å¸®', key: 'D' }
                    ],
                    result: 'ä½ çš„æ€ç»´ä½“ç°äº†**å›¢ä½“æ ¼å±€**ï¼šæŠŠæ‰€æœ‰äººæ”¾åœ¨ç»Ÿä¸€è§„åˆ™ä¸‹è€ƒè™‘ï¼Œä¸å› äº²ç–è€Œæœ‰å·®åˆ«ã€‚è¿™æ˜¯ç°ä»£ç¤¾ä¼šçš„é€»è¾‘â€”â€”å¹³ç­‰ã€å¥‘çº¦ã€ç†æ€§ã€‚[2]'
                }
            },
            insight: {
                icon: 'ğŸ’¡',
                title: 'è§£é”æ¦‚å¿µï¼šå·®åº vs å›¢ä½“',
                content: `
                    **å·®åºæ ¼å±€**çš„æ ¸å¿ƒæ˜¯"äº²ç–æœ‰åˆ«"ï¼š\n
                    - å¯¹ä¸åŒåœˆå±‚çš„äººï¼Œæƒåˆ©ä¹‰åŠ¡ä¸åŒ\n
                    - "è‡ªå·±äºº"å¯ä»¥è¦æ±‚æ›´å¤šï¼Œä¹Ÿæ‰¿æ‹…æ›´å¤š\n
                    - æ²¡æœ‰ç»Ÿä¸€çš„é“å¾·æ ‡å‡†\n\n
                    **å›¢ä½“æ ¼å±€**çš„æ ¸å¿ƒæ˜¯"ä¸€è§†åŒä»"ï¼š\n
                    - åœ¨åŒä¸€å›¢ä½“ï¼ˆå…¬å¸ã€ä¿±ä¹éƒ¨ï¼‰å†…ï¼Œè§„åˆ™ç»Ÿä¸€\n
                    - ä¸è€ƒè™‘ç§äººå…³ç³»ï¼Œåªçœ‹æ˜¯å¦ç¬¦åˆè§„åˆ™\n
                    - æœ‰æ˜ç¡®çš„å›¢ä½“è¾¹ç•Œ
                `,
                tags: ['å·®åºæ ¼å±€', 'å›¢ä½“æ ¼å±€', 'äº²ç–æœ‰åˆ«']
            }
        },
        
        {
            type: 'scenario',
            title: 'æƒ…å¢ƒäºŒï¼šè½¦ä½äº‰å¤º',
            question: 'å°åŒºè½¦ä½ç´§å¼ ï¼Œä½ åœè½¦æ—¶å‘ç°æœ‰äººå äº†ä½ å¸¸åœçš„ä½ç½®',
            options: {
                differential: {
                    label: 'å·®åºæ ¼å±€æ€ç»´',
                    choices: [
                        { text: 'çœ‹æ˜¯è°çš„è½¦ï¼šç†Ÿäººçš„è¯æ‰“ç”µè¯åå•†ï¼Œé™Œç”Ÿäººå°±å‘ç«', key: 'A' },
                        { text: 'æ‰˜å…³ç³»ï¼šæ‰¾ç‰©ä¸šçš„ç†Ÿäººå¸®å¿™è¯´è¯', key: 'B' }
                    ],
                    result: 'å…¸å‹çš„**å·®åºæ ¼å±€**å¤„ç†æ–¹å¼ï¼šåŒæ ·çš„é—®é¢˜ï¼Œå¯¹"è‡ªå·±äºº"å’Œ"å¤–äºº"é‡‡å–å®Œå…¨ä¸åŒçš„æ€åº¦ã€‚å…³ç³»æˆä¸ºè§£å†³é—®é¢˜çš„é¦–è¦è€ƒè™‘ã€‚[1]'
                },
                group: {
                    label: 'å›¢ä½“æ ¼å±€æ€ç»´',
                    choices: [
                        { text: 'çœ‹è§„åˆ™ï¼šå…ˆåˆ°å…ˆå¾—ï¼Œåªèƒ½æ¥å—', key: 'C' },
                        { text: 'æ‰¾ç‰©ä¸šï¼šæŒ‰å°åŒºè§„å®šå¤„ç†ï¼Œä¸ç®¡æ˜¯è°', key: 'D' }
                    ],
                    result: 'å…¸å‹çš„**å›¢ä½“æ ¼å±€**å¤„ç†æ–¹å¼ï¼šé—®é¢˜äº¤ç»™åˆ¶åº¦å’Œè§„åˆ™ï¼Œä¸å› äººè€Œå¼‚ã€‚æ‰€æœ‰ä¸šä¸»åœ¨è§„åˆ™é¢å‰å¹³ç­‰ã€‚[2]'
                }
            },
            insight: {
                icon: 'âš–ï¸',
                title: 'æ·±åŒ–ç†è§£ï¼šè§„åˆ™ vs äººæƒ…',
                content: `
                    å·®åºæ ¼å±€ä¸ºä»€ä¹ˆä¼šæœ‰"èµ°åé—¨"ï¼Ÿ\n
                    â†’ å› ä¸º**å…³ç³»ä¼˜å…ˆäºè§„åˆ™**ã€‚å¯¹"è‡ªå·±äºº"å¯ä»¥ä¾‹å¤–ã€‚\n\n
                    å›¢ä½“æ ¼å±€ä¸ºä»€ä¹ˆæ›´"å…¬å¹³"ï¼Ÿ\n
                    â†’ å› ä¸º**è§„åˆ™ä¼˜å…ˆäºå…³ç³»**ã€‚æ‰€æœ‰äººæŒ‰åŒä¸€æ ‡å‡†ã€‚\n\n
                    ä½†å›¢ä½“æ ¼å±€ä¹Ÿæ›´"å†·æ¼ "ï¼š\n
                    â†’ äººä¸äººä¹‹é—´æ˜¯**åŠŸèƒ½æ€§å…³ç³»**ï¼Œåªåœ¨ç‰¹å®šåœºåˆæ¥è§¦ã€‚
                `,
                tags: ['äººæƒ…ç¤¾ä¼š', 'è§„åˆ™æ„è¯†', 'èµ°åé—¨']
            }
        },
        
        {
            type: 'scenario',
            title: 'æƒ…å¢ƒä¸‰ï¼šå·¥ä½œæœºä¼š',
            question: 'ä½ çš„å…¬å¸æœ‰ä¸ªæ™‹å‡åé¢ï¼Œå€™é€‰äººä¸­æœ‰ä½ è¡¨å¼Ÿï¼Œä»–èƒ½åŠ›ä¸€èˆ¬',
            options: {
                differential: {
                    label: 'å·®åºæ ¼å±€æ€ç»´',
                    choices: [
                        { text: 'å¸®äº²æˆšï¼šèƒ½åŠ›å·®ç‚¹æ²¡å…³ç³»ï¼Œè‡ªå·±äººè¦ç…§é¡¾', key: 'A' },
                        { text: 'çœ‹å…³ç³»ï¼šå¦‚æœæ˜¯äº²å…„å¼Ÿä¸€å®šå¸®ï¼Œè¡¨å¼Ÿå°±ç®—äº†', key: 'B' }
                    ],
                    result: 'ä½ åœ¨ç”¨**å·®åºæ ¼å±€**çš„é€»è¾‘ï¼šäº²å±å…³ç³»å¸¦æ¥ç‰¹æ®Šä¹‰åŠ¡ã€‚"ä¸¾è´¤ä¸é¿äº²"åœ¨ä¼ ç»Ÿç¤¾ä¼šæ˜¯ç¾å¾·ï¼Œå› ä¸º"è‡ªå·±äºº"æœ€å¯é ã€‚[1]'
                },
                group: {
                    label: 'å›¢ä½“æ ¼å±€æ€ç»´',
                    choices: [
                        { text: 'çœ‹èƒ½åŠ›ï¼šè°æœ€èƒœä»»è°ä¸Šï¼Œä¸ç®¡æ˜¯ä¸æ˜¯äº²æˆš', key: 'C' },
                        { text: 'é¿å«Œï¼šæ­£å› ä¸ºæ˜¯äº²æˆšï¼Œæˆ‘åè€Œè¦å›é¿å†³ç­–', key: 'D' }
                    ],
                    result: 'ä½ åœ¨ç”¨**å›¢ä½“æ ¼å±€**çš„é€»è¾‘ï¼šåœ¨"å…¬å¸"è¿™ä¸ªå›¢ä½“é‡Œï¼Œæ‰€æœ‰äººæŒ‰èƒ½åŠ›å’Œè´¡çŒ®è¯„ä»·ï¼Œäº²ç¼˜å…³ç³»åº”è¯¥éš”ç¦»åœ¨å¤–ã€‚[2]'
                }
            },
            insight: {
                icon: 'ğŸ”',
                title: 'æ‰¹åˆ¤æ€§æ€è€ƒï¼šä¸¤ç§æ ¼å±€çš„ä¼˜åŠ£',
                content: `
                    **å·®åºæ ¼å±€çš„ä¼˜åŠ¿ï¼š**\n
                    - äººé™…å…³ç³»æ¸©æš–ï¼Œæœ‰å½’å±æ„Ÿ\n
                    - äº’åŠ©ç½‘ç»œå¼ºå¤§ï¼Œå›°éš¾æ—¶æœ‰äººå¸®\n
                    - ä¼¦ç†é“å¾·æ¸…æ™°ï¼ŒçŸ¥é“è¯¥æ€ä¹ˆåš\n\n
                    **å·®åºæ ¼å±€çš„é—®é¢˜ï¼š**\n
                    - å®¹æ˜“å½¢æˆå°åœˆå­ã€è£™å¸¦å…³ç³»\n
                    - å…¬å…±åˆ©ç›Šè®©ä½äºç§äººå…³ç³»\n
                    - é™Œç”Ÿäººä¹‹é—´ç¼ºä¹ä¿¡ä»»\n\n
                    **å½“ä»£ä¸­å›½çš„ç°å®ï¼š**\n
                    æ—¢ä¸æ˜¯çº¯ç²¹çš„å·®åºï¼Œä¹Ÿä¸æ˜¯çº¯ç²¹çš„å›¢ä½“ï¼Œ\n
                    è€Œæ˜¯**ä¸¤ç§æ ¼å±€å¹¶å­˜ã€è½¬å‹ä¸­çš„æ··åˆçŠ¶æ€**ã€‚
                `,
                tags: ['ç¤¾ä¼šè½¬å‹', 'ä¼ ç»Ÿä¸ç°ä»£', 'æ‰¹åˆ¤æ€§æ€ç»´']
            }
        },
        
        // Step 5: æ€»ç»“å¯¹æ¯”
        {
            type: 'summary',
            title: 'æ¦‚å¿µæ€»ç»“ï¼šä¸¤ç§ç¤¾ä¼šç»“æ„'
        }
    ],
    
    init() {
        this.renderStep();
    },
    
    renderStep() {
        const container = document.getElementById('chapter-2');
        const step = this.steps[this.currentStep];
        
        if (!step) return;
        
        let html = '';
        
        switch(step.type) {
            case 'intro':
                html = step.content;
                break;
            case 'draw-circles':
                html = this.renderDrawCircles(step);
                break;
            case 'scenario':
                html = this.renderScenario(step);
                break;
            case 'summary':
                html = this.renderSummary();
                break;
        }
        
        container.innerHTML = html;
        this.bindEvents();
    },
    
    renderDrawCircles(step) {
        let html = '<div class="circle-builder">';
        html += `<h2>${step.title}</h2>`;
        html += `<p class="instruction">${step.instruction}</p>`;
        
        // å¯è§†åŒ–å…³ç³»åœˆ
        html += '<div class="circles-visual">';
        html += '<div class="circle-layer circle-4"><span class="circle-label">é™Œç”Ÿäºº</span></div>';
        html += '<div class="circle-layer circle-3"><span class="circle-label">é‚»å±…åŒäº‹</span></div>';
        html += '<div class="circle-layer circle-2"><span class="circle-label">äº²æˆšæœ‹å‹</span></div>';
        html += '<div class="circle-layer circle-1"><span class="circle-label">å®¶äºº</span></div>';
        html += '<div class="circle-center">æˆ‘</div>';
        html += '</div>';
        
        // äººç‰©å¡ç‰‡
        html += '<div class="people-cards">';
        step.people.forEach((person, idx) => {
            html += `
                <div class="person-card" data-idx="${idx}">
                    <div class="person-name">${person.name}</div>
                    <select class="circle-select" data-person="${person.name}">
                        <option value="1" ${person.defaultCircle === 1 ? 'selected' : ''}>å®¶äººåœˆ</option>
                        <option value="2" ${person.defaultCircle === 2 ? 'selected' : ''}>äº²å‹åœˆ</option>
                        <option value="3" ${person.defaultCircle === 3 ? 'selected' : ''}>ç†Ÿäººåœˆ</option>
                        <option value="4" ${person.defaultCircle === 4 ? 'selected' : ''}>é™Œç”Ÿäººåœˆ</option>
                    </select>
                </div>
            `;
        });
        html += '</div>';
        
        html += '<button class="next-btn" onclick="Chapter2.nextStep()">å®Œæˆåˆ†é… â†’</button>';
        html += '</div>';
        
        return html;
    },
    
    renderScenario(step) {
        let html = '<div class="scenario-dual">';
        
        // åœºæ™¯æè¿°
        html += `<h2>${step.title}</h2>`;
        html += `<div class="scenario-question">${step.question}</div>`;
        
        // åŒæ é€‰æ‹©
        html += '<div class="dual-options">';
        
        // å·¦æ ï¼šå·®åºæ ¼å±€
        html += '<div class="option-panel differential">';
        html += `<h3>${step.options.differential.label}</h3>`;
        step.options.differential.choices.forEach(choice => {
            html += `<button class="choice-btn" data-type="differential" data-key="${choice.key}">`;
            html += choice.text;
            html += '</button>';
        });
        html += '<div class="result-box" id="differential-result"></div>';
        html += '</div>';
        
        // å³æ ï¼šå›¢ä½“æ ¼å±€
        html += '<div class="option-panel group">';
        html += `<h3>${step.options.group.label}</h3>`;
        step.options.group.choices.forEach(choice => {
            html += `<button class="choice-btn" data-type="group" data-key="${choice.key}">`;
            html += choice.text;
            html += '</button>';
        });
        html += '<div class="result-box" id="group-result"></div>';
        html += '</div>';
        
        html += '</div>'; // end dual-options
        
        html += '<div id="insight-box" class="hidden"></div>';
        html += '<button id="next-btn" class="next-btn hidden" onclick="Chapter2.nextStep()">ç»§ç»­ â†’</button>';
        html += '</div>';
        
        return html;
    },
    
    renderSummary() {
        let html = '<div class="summary-page">';
        html += '<h2 class="summary-title">ğŸ“ ç¬¬äºŒç« å®Œæˆï¼</h2>';
        
        html += '<div class="comparison-grid">';
        html += '<div class="comparison-item">';
        html += '<div class="comparison-label">ğŸŒ¾ å·®åºæ ¼å±€</div>';
        html += '<div class="comparison-text">';
        html += '<ul>';
        html += '<li>ä»¥"æˆ‘"ä¸ºä¸­å¿ƒçš„åŒå¿ƒåœ†ç»“æ„</li>';
        html += '<li>äº²ç–æœ‰åˆ«ï¼Œæƒåˆ©ä¹‰åŠ¡å› äººè€Œå¼‚</li>';
        html += '<li>äººæƒ…é‡äºè§„åˆ™</li>';
        html += '<li>é€‚åˆç†Ÿäººç¤¾ä¼š</li>';
        html += '</ul>';
        html += '</div>';
        html += '</div>';
        
        html += '<div class="comparison-item">';
        html += '<div class="comparison-label">ğŸ™ï¸ å›¢ä½“æ ¼å±€</div>';
        html += '<div class="comparison-text">';
        html += '<ul>';
        html += '<li>ä»¥"å›¢ä½“"ä¸ºå•ä½çš„è¾¹ç•Œç»“æ„</li>';
        html += '<li>å›¢ä½“å†…ä¸€è§†åŒä»</li>';
        html += '<li>è§„åˆ™é‡äºäººæƒ…</li>';
        html += '<li>é€‚åˆé™Œç”Ÿäººç¤¾ä¼š</li>';
        html += '</ul>';
        html += '</div>';
        html += '</div>';
        html += '</div>';
        
        html += '<div class="final-insight">';
        html += '<h3>ğŸ“– è´¹å­é€šçš„æ´å¯Ÿ</h3>';
        html += '<p>ä¸­å›½ä¼ ç»Ÿç¤¾ä¼šæ˜¯**å·®åºæ ¼å±€**ï¼Œè¥¿æ–¹ç°ä»£ç¤¾ä¼šæ˜¯**å›¢ä½“æ ¼å±€**ã€‚è¿™ä¸æ˜¯ä¼˜åŠ£ä¹‹åˆ†ï¼Œè€Œæ˜¯å†å²å½¢æˆçš„ä¸åŒç¤¾ä¼šç»“æ„ã€‚</p>';
        html += '<p>å½“ä»£ä¸­å›½æ­£åœ¨ç»å†ä»<strong>å·®åºæ ¼å±€å‘å›¢ä½“æ ¼å±€</strong>çš„è½¬å‹ï¼Œä¸¤ç§æ ¼å±€å¹¶å­˜ï¼Œå¸¦æ¥å¾ˆå¤šçŸ›ç›¾å’Œå†²çªâ€”â€”è¿™æ­£æ˜¯ç†è§£å½“ä¸‹ä¸­å›½ç¤¾ä¼šçš„å…³é”®ã€‚</p>';
        html += '</div>';
        
        html += '<div class="action-buttons">';
        html += '<button class="action-btn" onclick="Chapter2.restart()">ğŸ”„ é‡æ–°ä½“éªŒ</button>';
        html += '<button class="action-btn share" onclick="shareAsImage(\'.summary-page\', \'å·®åºæ ¼å±€_å­¦ä¹ æ€»ç»“\')">ğŸ“¸ ä¿å­˜æ€»ç»“</button>';
        html += '</div>';
        
        html += '</div>';
        return html;
    },
    
    bindEvents() {
        // ç»‘å®šåœºæ™¯é€‰æ‹©äº‹ä»¶[2]
        document.querySelectorAll('.choice-btn').forEach(btn => {
            btn.addEventListener('click', () => {
                this.makeChoice(btn.dataset.type, btn.dataset.key);
            });
        });
    },
    
    makeChoice(type, key) {
        const step = this.steps[this.currentStep];
        this.scenarios.push({ step: this.currentStep, type, key });
        
        // æ˜¾ç¤ºå¯¹åº”ç»“æœ[2]
        const result = step.options[type].result;
        document.getElementById(`${type}-result`).innerHTML = 
            `<div class="result-content">${renderMarkdown(result)}</div>`;
        
        // ç¦ç”¨æ‰€æœ‰æŒ‰é’®
        document.querySelectorAll('.choice-btn').forEach(btn => btn.disabled = true);
        
        // æ˜¾ç¤ºæ¦‚å¿µè§£é”[1][2]
        setTimeout(() => this.showInsight(step.insight), 800);
    },
    
    showInsight(insight) {
        this.insights.push(insight.title);
        
        const html = `
            <div class="insight-unlock">
                <div class="insight-icon">${insight.icon}</div>
                <div class="insight-title">${insight.title}</div>
                <div class="insight-content">${renderMarkdown(insight.content)}</div>
                <div>
                    ${insight.tags.map(t => `<span class="insight-tag">${t}</span>`).join('')}
                </div>
            </div>
        `;
        
        document.getElementById('insight-box').innerHTML = html;
        document.getElementById('insight-box').classList.remove('hidden');
        document.getElementById('next-btn').classList.remove('hidden');
        
        notify('ğŸ“ è§£é”æ–°æ¦‚å¿µï¼š' + insight.tags[0]);
        scrollToBottom();
    },
    
    nextStep() {
        this.currentStep++;
        
        if (this.currentStep >= this.steps.length) {
            // å®Œæˆç¬¬äºŒç« 
            GameManager.completeChapter2();
        } else {
            this.renderStep();
            scrollToTop();
        }
    },
    
    restart() {
        this.currentStep = 0;
        this.scenarios = [];
        this.insights = [];
        this.renderStep();
        scrollToTop();
    }
};
