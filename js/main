// ä¸»æ§åˆ¶é€»è¾‘[1]

const GameManager = {
    currentChapter: 1,
    chapter1Complete: false,
    chapter2Unlocked: false,
    
    init() {
        this.bindChapterButtons();
        this.updateProgress();
        Chapter1.init();
    },
    
    bindChapterButtons() {
        document.querySelectorAll('.chapter-btn').forEach(btn => {
            btn.addEventListener('click', () => {
                const chapter = parseInt(btn.dataset.chapter);
                this.switchChapter(chapter);
            });
        });
    },
    
    switchChapter(num) {
        if (num === 2 && !this.chapter2Unlocked) {
            notify('âš ï¸ è¯·å…ˆå®Œæˆç¬¬ä¸€ç« ä½“éªŒï¼');
            return;
        }
        
        // éšè—æ‰€æœ‰ç« èŠ‚
        document.querySelectorAll('.chapter-content').forEach(c => {
            c.classList.remove('active');
        });
        document.querySelectorAll('.chapter-btn').forEach(b => {
            b.classList.remove('active');
        });
        
        // æ˜¾ç¤ºç›®æ ‡ç« èŠ‚
        document.getElementById(`chapter-${num}`).classList.add('active');
        document.querySelector(`[data-chapter="${num}"]`).classList.add('active');
        this.currentChapter = num;
        
        // åˆå§‹åŒ–å¯¹åº”ç« èŠ‚
        if (num === 2 && !this.chapter2Initialized) {
            Chapter2.init();
            this.chapter2Initialized = true;
        }
        
        this.updateProgress();
        scrollToTop();
    },
    
    completeChapter1() {
        this.chapter1Complete = true;
        this.chapter2Unlocked = true;
        
        // è§£é”ç¬¬äºŒç« 
        const btn = document.getElementById('chapter2-btn');
        btn.classList.remove('locked');
        btn.querySelector('.lock-icon').textContent = 'âœ…';
        
        notify('ğŸ‰ æ­å–œå®Œæˆç¬¬ä¸€ç« ï¼å·²è§£é”ç¬¬äºŒç« ');
        this.updateProgress();
    },

    completeChapter2() {
    notify('ğŸ‰ æ­å–œå®Œæˆç¬¬äºŒç« ï¼ä½ å·²æŒæ¡ã€Šä¹¡åœŸä¸­å›½ã€‹æ ¸å¿ƒæ¦‚å¿µ');
    this.updateProgress();
    }ï¼Œ

    updateProgress() {
        let progress = 0;
        if (this.chapter1Complete) progress += 50;
        if (this.currentChapter === 2) progress += 25;
        
        document.getElementById('overall-progress').style.width = progress + '%';
        document.getElementById('progress-text').textContent = 
            `æ•´ä½“è¿›åº¦ï¼š${progress}%`;
    }
};

// é¡µé¢åŠ è½½æ—¶åˆå§‹åŒ–
window.addEventListener('DOMContentLoaded', () => {
    GameManager.init();
});
